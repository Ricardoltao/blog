---
title: 跨域
date: 2020-03-03 17:04:24
tags:
- 跨域
- CORS
- JSONP
category: 网络
---
## 前言

跨域是一个常考点，平常也有所了解，在这里做一个简单的总结。



## 什么是跨域

跨域是指当前域名下想请求另一个域名下的资源但是由于同源策略的限制，而不能直接发送请求请求。

#### 同源策略

同源是指：协议+域名+端口 三者相同，如果缺少同源策略很容易受到XSS、CSFR等攻击。



## 跨域解决方案

### Jsonp

通常为了减轻web服务器的负载，我们把js、css、img等静态资源分离到另一个独立域名的服务器上，在html页面中通过相应的标签从不同域名下加载静态资源，而被浏览器允许，基于此原理，我们可以通过动态创建script，再请求一个带参网址实现跨域通信。

利用`<script>`标签没有跨域限制，将src设置为需要访问的url，并提供一个回调函数来接收数据。只限于get请求。

具体代码：

```js
function jsonp(url,jsonpCallback,success){
    let script = document.creatElement('script')
    script.src = url
    script.async = true
    script.type = 'text/javascript'
    // 约定一个callback字段名，来传递函数名，前端通过该函数来拿到数据
    window[jsonpCallback] = function(data){
        success && success(data)
    }
    document.body.appendChild(script)
}

jsonp('http://xxx', 'callback', function(value) {
  console.log(value)
})
```



### CORS

他允许浏览器向跨域服务器发出XMLHTTPRequest请求，从而克服跨域问题，他需要浏览器和服务器同时支持。

服务器端需需要添加一些头部属性，客户端需要增加orgin字段

```js
// 引入http库
var http = require('http');

http.createServer(function (request, response) {

    response.writeHead(200, {
      // 字段
      'Content-Type': 'text/plain',
      // 允许请求的地址
      'Access-Control-Allow-Origin': '*',
      // 请求方法
      'Access-Control-Allow-Methods': 'GET, POST, PUT'
    });

    response.end('request success!!!');
}).listen(8888);

console.log('Server running at http://127.0.0.1:8888/');

```